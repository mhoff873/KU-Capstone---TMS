{% extends 'base.html' %}
{% block content %}

<script>
        /* stores the ordered state of columns */
        var asc1=1;
        var asc2=1;
        var asc3=1;
        var asc4=1;
        
        // sorts a column of a tbody
        function sort_table(tbody, col, asc) {
            var rows = tbody.rows,
                rlen = rows.length;
            
            var swapped;
            do {
                swapped = false;
                for (var i=0; i < rlen-1; i++) {
                    if (asc==1){
                            if (rows[i].cells[col].textContent > rows[i+1].cells[col].textContent) { //ascending order
                                tbody.insertBefore(rows[i+1], rows[i]);
                                swapped = true;
                            }
                    }if (asc==-1){
                            if (rows[i].cells[col].textContent < rows[i+1].cells[col].textContent) { //descending order
                                tbody.insertBefore(rows[i+1], rows[i]);
                                swapped = true;
                            }
                    }
                }
            } while (swapped);
        }
</script>

<div class="jumbotron text-center">
	<h1>Survey Results</h1>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  <!-- Categories: success (green), info (blue), warning (yellow), danger (red) -->
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <!-- <strong>Title</strong> --> {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<br>
<div class="container">
        <div class="page_content">
<div class="row">
<div class="col-sm-4">
<a href="{{url_for('surveyCreation')}}" role="button" class="btn btn-secondary btn-lg btn-block">Create Survey</a>
</div>
<div class="col-sm-4">
<a href="{{url_for('surveys')}}" role="button" class="btn btn-secondary btn-lg btn-block">Survey Management</a>
</div>
</div>
<br>

<div class="row">
  <div class="table-responsive col-md-12">
    <h2 class="sub-header text-center">Completed Surveys</h2>
    <table class="table table-hover">
<thead>
<th onclick='sort_table(result_table, 0, asc1);asc1 *= -1; asc2=1; asc3=1; asc4=1;'>Task Name</th>
<th onclick='sort_table(result_table, 1, asc2);asc2 *= -1; asc1=1; asc3=1; asc4=1;'>Survey Name</th>
<th onclick='sort_table(result_table, 2, asc3);asc3 *= -1; asc2=1; asc1=1; asc4=1;'>User</th>
<th onclick='sort_table(result_table, 3, asc4);asc4 *= -1; asc3=1; asc2=1; asc1=1;'>Date Completed</th>
</thead>
<tbody id='result_table'>
        {% for r in result_struct %} 
          <tr id='result_{{r["formID"]}}'>
            <td>{{r['taskTitle']}}</td>
            <td>{{r['surveyTitle']}}</td>
            <td>{{r['userName']}}</td>
            <td>{{r['date']}}</td>
          </tr> 
        {% endfor %}
</tbody>
</table>
</div>
</div>

</div>
</div>

{% endblock content %}
